{% extends "base.html" %}

{% block title %}Diet Plans - AROGYA Healthcare{% endblock %}

{% block content %}
<div class="container mx-auto px-4 py-8">
    <div class="mb-8">
        <h1 class="text-3xl font-bold text-gray-900">Personalized Diet Plans</h1>
        <p class="text-gray-600">Get customized diet plans for better health and wellness</p>
    </div>

    <!-- Diet Plan Quiz -->
    <div class="bg-white rounded-lg shadow-lg p-6 mb-8">
        <h2 class="text-xl font-bold mb-4">Get Your Personalized Diet Plan</h2>
        <form id="dietQuizForm">
            <div class="grid md:grid-cols-2 gap-6">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Age</label>
                    <input type="number" name="age" required min="1" max="120" 
                           class="w-full border rounded-lg p-2" placeholder="Enter your age">
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Gender</label>
                    <select name="gender" class="w-full border rounded-lg p-2">
                        <option value="">Select gender</option>
                        <option value="male">Male</option>
                        <option value="female">Female</option>
                        <option value="other">Other</option>
                    </select>
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Height (cm)</label>
                    <input type="number" name="height" required min="50" max="250" 
                           class="w-full border rounded-lg p-2" placeholder="Enter height in cm">
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Weight (kg)</label>
                    <input type="number" name="weight" required min="20" max="300" 
                           class="w-full border rounded-lg p-2" placeholder="Enter weight in kg">
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Activity Level</label>
                    <select name="activity" class="w-full border rounded-lg p-2">
                        <option value="">Select activity level</option>
                        <option value="sedentary">Sedentary (little or no exercise)</option>
                        <option value="light">Light (1-3 days/week exercise)</option>
                        <option value="moderate">Moderate (3-5 days/week exercise)</option>
                        <option value="active">Active (6-7 days/week exercise)</option>
                        <option value="very-active">Very Active (very hard exercise)</option>
                    </select>
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Health Goal</label>
                    <select name="goal" class="w-full border rounded-lg p-2">
                        <option value="">Select your goal</option>
                        <option value="weight-loss">Weight Loss</option>
                        <option value="weight-gain">Weight Gain</option>
                        <option value="muscle-gain">Muscle Gain</option>
                        <option value="maintenance">Maintain Weight</option>
                        <option value="general-health">General Health</option>
                    </select>
                </div>
                
                <div class="md:col-span-2">
                    <label class="block text-sm font-medium text-gray-700 mb-2">Dietary Preferences</label>
                    <div class="grid grid-cols-2 md:grid-cols-4 gap-2">
                        <label class="flex items-center">
                            <input type="checkbox" name="preferences" value="vegetarian" class="mr-2">
                            <span>Vegetarian</span>
                        </label>
                        <label class="flex items-center">
                            <input type="checkbox" name="preferences" value="vegan" class="mr-2">
                            <span>Vegan</span>
                        </label>
                        <label class="flex items-center">
                            <input type="checkbox" name="preferences" value="gluten-free" class="mr-2">
                            <span>Gluten-Free</span>
                        </label>
                        <label class="flex items-center">
                            <input type="checkbox" name="preferences" value="diabetic" class="mr-2">
                            <span>Diabetic</span>
                        </label>
                    </div>
                </div>
                
                <div class="md:col-span-2">
                    <label class="block text-sm font-medium text-gray-700 mb-2">Health Conditions (if any)</label>
                    <textarea name="conditions" rows="3" class="w-full border rounded-lg p-2" 
                              placeholder="Mention any health conditions like diabetes, hypertension, etc."></textarea>
                </div>
            </div>
            
            <button type="submit" class="w-full bg-purple-600 text-white py-3 rounded-lg font-semibold hover:bg-purple-700 transition">
                Generate Diet Plan
            </button>
        </form>
    </div>

    <!-- Results Section -->
    <div id="resultsSection" class="hidden">
        <div class="bg-white rounded-lg shadow-lg p-6">
            <h2 class="text-2xl font-bold mb-6">Your Personalized Diet Plan</h2>
            <div id="dietPlanResults">
                <!-- Diet plan will be displayed here -->
            </div>
        </div>
    </div>

    <!-- Sample Diet Plans -->
    <div class="mt-8">
        <h2 class="text-2xl font-bold mb-6">Sample Diet Plans</h2>
        <div class="grid md:grid-cols-3 gap-6">
            <div class="bg-white rounded-lg shadow-lg p-6">
                <div class="bg-green-100 text-green-800 px-3 py-1 rounded-full text-sm font-medium inline-block mb-4">
                    Weight Loss
                </div>
                <h3 class="text-xl font-bold mb-3">Balanced Weight Loss Plan</h3>
                <p class="text-gray-600 mb-4">1200-1500 calories per day with balanced nutrients</p>
                <ul class="space-y-2 text-sm text-gray-600">
                    <li>• High protein breakfast</li>
                    <li>• Fiber-rich lunch</li>
                    <li>• Light dinner</li>
                    <li>• Healthy snacks</li>
                </ul>
                <button onclick="viewSamplePlan('weight-loss')" class="mt-4 w-full bg-purple-600 text-white py-2 rounded-lg font-semibold hover:bg-purple-700 transition">
                    View Plan
                </button>
            </div>
            
            <div class="bg-white rounded-lg shadow-lg p-6">
                <div class="bg-blue-100 text-blue-800 px-3 py-1 rounded-full text-sm font-medium inline-block mb-4">
                    Muscle Gain
                </div>
                <h3 class="text-xl font-bold mb-3">High Protein Muscle Plan</h3>
                <p class="text-gray-600 mb-4">2000-2500 calories with high protein content</p>
                <ul class="space-y-2 text-sm text-gray-600">
                    <li>• Protein-rich breakfast</li>
                    <li>• Balanced meals</li>
                    <li>• Pre/post workout nutrition</li>
                    <li>• Lean protein sources</li>
                </ul>
                <button onclick="viewSamplePlan('muscle-gain')" class="mt-4 w-full bg-purple-600 text-white py-2 rounded-lg font-semibold hover:bg-purple-700 transition">
                    View Plan
                </button>
            </div>
            
            <div class="bg-white rounded-lg shadow-lg p-6">
                <div class="bg-purple-100 text-purple-800 px-3 py-1 rounded-full text-sm font-medium inline-block mb-4">
                    General Health
                </div>
                <h3 class="text-xl font-bold mb-3">Balanced Nutrition Plan</h3>
                <p class="text-gray-600 mb-4">1800-2000 calories for optimal health</p>
                <ul class="space-y-2 text-sm text-gray-600">
                    <li>• Whole grains</li>
                    <li>• Fresh fruits & vegetables</li>
                    <li>• Healthy fats</li>
                    <li>• Balanced macros</li>
                </ul>
                <button onclick="viewSamplePlan('general-health')" class="mt-4 w-full bg-purple-600 text-white py-2 rounded-lg font-semibold hover:bg-purple-700 transition">
                    View Plan
                </button>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
// Diet plan quiz
document.getElementById('dietQuizForm').addEventListener('submit', function(e) {
    e.preventDefault();
    
    const formData = new FormData(e.target);
    const data = Object.fromEntries(formData.entries());
    
    // Calculate BMI
    const height = parseFloat(data.height) / 100; // Convert cm to m
    const weight = parseFloat(data.weight);
    const bmi = weight / (height * height);
    
    // Calculate daily calories
    let bmr;
    if (data.gender === 'male') {
        bmr = 88.362 + (13.397 * weight) + (4.799 * (height * 100)) - (5.677 * parseInt(data.age));
    } else {
        bmr = 447.593 + (9.247 * weight) + (3.098 * (height * 100)) - (4.330 * parseInt(data.age));
    }
    
    // Activity multiplier
    const activityMultipliers = {
        'sedentary': 1.2,
        'light': 1.375,
        'moderate': 1.55,
        'active': 1.725,
        'very-active': 1.9
    };
    
    const tdee = bmr * (activityMultipliers[data.activity] || 1.2);
    
    // Adjust calories based on goal
    let targetCalories = tdee;
    if (data.goal === 'weight-loss') {
        targetCalories = tdee - 500;
    } else if (data.goal === 'weight-gain') {
        targetCalories = tdee + 500;
    }
    
    // Generate diet plan
    const dietPlan = generateDietPlan(data, targetCalories, bmi);
    displayDietPlan(dietPlan, bmi, targetCalories);
});

function generateDietPlan(data, calories, bmi) {
    const preferences = Array.isArray(data.preferences) ? data.preferences : 
                       (data.preferences ? [data.preferences] : []);
    
    const isVegetarian = preferences.includes('vegetarian') || preferences.includes('vegan');
    const isVegan = preferences.includes('vegan');
    const isDiabetic = preferences.includes('diabetic');
    
    const proteinSources = isVegetarian ? 
        ['Lentils', 'Beans', 'Tofu', 'Paneer', 'Greek Yogurt', 'Quinoa'] :
        ['Chicken Breast', 'Fish', 'Eggs', 'Lean Meat', 'Greek Yogurt', 'Tofu'];
    
    const carbSources = isDiabetic ? 
        ['Brown Rice', 'Quinoa', 'Sweet Potato', 'Oats', 'Whole Wheat Bread'] :
        ['Brown Rice', 'Quinoa', 'Whole Wheat Pasta', 'Oats', 'Sweet Potato'];
    
    const fatSources = ['Avocado', 'Nuts', 'Olive Oil', 'Seeds', 'Nut Butter'];
    
    return {
        breakfast: {
            calories: Math.round(calories * 0.3),
            items: [
                `${proteinSources[0]} (100g)`,
                `${carbSources[2]} (50g)`,
                'Mixed Vegetables (100g)',
                'Green Tea'
            ]
        },
        lunch: {
            calories: Math.round(calories * 0.35),
            items: [
                `${proteinSources[1]} (150g)`,
                `${carbSources[0]} (1 cup cooked)`,
                'Salad with Olive Oil',
                'Fresh Fruit'
            ]
        },
        snack: {
            calories: Math.round(calories * 0.15),
            items: [
                `${fatSources[0]} (1/4)`,
                'Greek Yogurt (100g)',
                'Nuts (20g)'
            ]
        },
        dinner: {
            calories: Math.round(calories * 0.2),
            items: [
                `${proteinSources[2]} (100g)`,
                'Steamed Vegetables',
                'Small portion of carbs',
                'Herbal Tea'
            ]
        },
        recommendations: [
            'Drink 8-10 glasses of water daily',
            'Eat every 2-3 hours',
            'Avoid processed foods',
            'Include 30 minutes of exercise',
            'Get 7-8 hours of sleep'
        ]
    };
}

function displayDietPlan(plan, bmi, calories) {
    const resultsSection = document.getElementById('resultsSection');
    const resultsContent = document.getElementById('dietPlanResults');
    
    let bmiCategory = 'Normal';
    let bmiColor = 'green';
    if (bmi < 18.5) {
        bmiCategory = 'Underweight';
        bmiColor = 'blue';
    } else if (bmi > 25) {
        bmiCategory = 'Overweight';
        bmiColor = 'orange';
    }
    
    resultsContent.innerHTML = `
        <div class="space-y-6">
            <!-- BMI and Calories -->
            <div class="grid md:grid-cols-2 gap-6">
                <div class="bg-${bmiColor}-50 border border-${bmiColor}-200 rounded-lg p-4">
                    <h3 class="font-bold text-${bmiColor}-900 mb-2">Your BMI</h3>
                    <p class="text-3xl font-bold text-${bmiColor}-900">${bmi.toFixed(1)}</p>
                    <p class="text-${bmiColor}-700">${bmiCategory}</p>
                </div>
                <div class="bg-purple-50 border border-purple-200 rounded-lg p-4">
                    <h3 class="font-bold text-purple-900 mb-2">Daily Calories</h3>
                    <p class="text-3xl font-bold text-purple-900">${Math.round(calories)}</p>
                    <p class="text-purple-700">Target calories per day</p>
                </div>
            </div>
            
            <!-- Meal Plan -->
            <div>
                <h3 class="text-xl font-bold mb-4">Daily Meal Plan</h3>
                <div class="grid md:grid-cols-2 gap-4">
                    <div class="border rounded-lg p-4">
                        <div class="flex justify-between items-center mb-3">
                            <h4 class="font-semibold">Breakfast</h4>
                            <span class="bg-blue-100 text-blue-800 px-2 py-1 rounded text-sm">${plan.breakfast.calories} cal</span>
                        </div>
                        <ul class="space-y-1 text-sm text-gray-600">
                            ${plan.breakfast.items.map(item => `<li>• ${item}</li>`).join('')}
                        </ul>
                    </div>
                    
                    <div class="border rounded-lg p-4">
                        <div class="flex justify-between items-center mb-3">
                            <h4 class="font-semibold">Lunch</h4>
                            <span class="bg-green-100 text-green-800 px-2 py-1 rounded text-sm">${plan.lunch.calories} cal</span>
                        </div>
                        <ul class="space-y-1 text-sm text-gray-600">
                            ${plan.lunch.items.map(item => `<li>• ${item}</li>`).join('')}
                        </ul>
                    </div>
                    
                    <div class="border rounded-lg p-4">
                        <div class="flex justify-between items-center mb-3">
                            <h4 class="font-semibold">Snack</h4>
                            <span class="bg-yellow-100 text-yellow-800 px-2 py-1 rounded text-sm">${plan.snack.calories} cal</span>
                        </div>
                        <ul class="space-y-1 text-sm text-gray-600">
                            ${plan.snack.items.map(item => `<li>• ${item}</li>`).join('')}
                        </ul>
                    </div>
                    
                    <div class="border rounded-lg p-4">
                        <div class="flex justify-between items-center mb-3">
                            <h4 class="font-semibold">Dinner</h4>
                            <span class="bg-purple-100 text-purple-800 px-2 py-1 rounded text-sm">${plan.dinner.calories} cal</span>
                        </div>
                        <ul class="space-y-1 text-sm text-gray-600">
                            ${plan.dinner.items.map(item => `<li>• ${item}</li>`).join('')}
                        </ul>
                    </div>
                </div>
            </div>
            
            <!-- Recommendations -->
            <div>
                <h3 class="text-xl font-bold mb-4">Additional Recommendations</h3>
                <div class="bg-blue-50 border border-blue-200 rounded-lg p-4">
                    <ul class="space-y-2">
                        ${plan.recommendations.map(rec => `
                            <li class="flex items-start space-x-2">
                                <svg class="h-5 w-5 text-blue-600 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
                                </svg>
                                <span class="text-gray-700">${rec}</span>
                            </li>
                        `).join('')}
                    </ul>
                </div>
            </div>
            
            <div class="flex space-x-4">
                <button onclick="window.print()" class="flex-1 bg-purple-600 text-white py-2 rounded-lg font-semibold hover:bg-purple-700 transition">
                    Print Diet Plan
                </button>
                <button onclick="downloadDietPlan()" class="flex-1 border border-purple-600 text-purple-600 py-2 rounded-lg font-semibold hover:bg-purple-50 transition">
                    Download PDF
                </button>
            </div>
        </div>
    `;
    
    resultsSection.classList.remove('hidden');
    resultsSection.scrollIntoView({ behavior: 'smooth' });
}

function viewSamplePlan(type) {
    const plans = {
        'weight-loss': {
            breakfast: { calories: 350, items: ['Oatmeal with Berries', 'Green Tea', 'Almonds (10)'] },
            lunch: { calories: 450, items: ['Grilled Chicken Salad', 'Whole Wheat Bread', 'Fresh Fruit'] },
            snack: { calories: 200, items: ['Greek Yogurt', 'Apple', 'Walnuts'] },
            dinner: { calories: 400, items: ['Vegetable Soup', 'Grilled Fish', 'Steamed Vegetables'] }
        },
        'muscle-gain': {
            breakfast: { calories: 600, items: ['Egg Whites (4)', 'Oatmeal', 'Banana', 'Protein Shake'] },
            lunch: { calories: 700, items: ['Grilled Chicken (200g)', 'Brown Rice', 'Broccoli', 'Sweet Potato'] },
            snack: { calories: 400, items: ['Protein Bar', 'Almonds', 'Greek Yogurt'] },
            dinner: { calories: 600, items: ['Salmon (200g)', 'Quinoa', 'Mixed Vegetables', 'Olive Oil'] }
        },
        'general-health': {
            breakfast: { calories: 450, items: ['Whole Grain Cereal', 'Milk', 'Berries', 'Honey'] },
            lunch: { calories: 550, items: ['Mixed Vegetable Curry', 'Brown Rice', 'Yogurt', 'Salad'] },
            snack: { calories: 250, items: ['Fresh Fruit', 'Nuts', 'Green Tea'] },
            dinner: { calories: 500, items: ['Lentil Soup', 'Whole Wheat Roti', 'Vegetable Stir-fry'] }
        }
    };
    
    const plan = plans[type];
    displayDietPlan(plan, 22.5, type === 'weight-loss' ? 1400 : type === 'muscle-gain' ? 2300 : 1750);
}

function downloadDietPlan() {
    alert('PDF download feature would be implemented here. For now, you can print or save the page.');
}
</script>
{% endblock %}
